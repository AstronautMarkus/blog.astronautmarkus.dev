---
interface Props {
    title: string;
    description: string;
    url: string;
}

const { title, description, url } = Astro.props;

const encodedTitle = encodeURIComponent(title);
const encodedDescription = encodeURIComponent(description);
const encodedUrl = encodeURIComponent(url);

const shareUrls = {
    facebook: `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`,
    twitter: `https://twitter.com/intent/tweet?url=${encodedUrl}&text=${encodedTitle}&via=astronautmarkus`,
    linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`,
    whatsapp: `https://wa.me/?text=${encodedTitle}%20${encodedUrl}`,
    telegram: `https://t.me/share/url?url=${encodedUrl}&text=${encodedTitle}`
};
---

<div class="shadow p-4 bg-[#c5c1c0]  mt-8">
    <h3 class="md:text-xl text-lg font-semibold mb-4 text-center playstation-fonts text-gray-800">Share this post</h3>
    <div class="flex flex-wrap gap-2 items-center justify-center">
        <a href={shareUrls.facebook} target="_blank" rel="noopener noreferrer"
           class="px-4 py-2 bg-[#ADADAD] text-black font-semibold  flex items-center gap-2 hover:bg-gray-300 transition shadow"
           aria-label="Share on Facebook">
            <i class="hn hn-facebook-square text-blue-700"></i>
            Facebook
        </a>
        <a href={shareUrls.twitter} target="_blank" rel="noopener noreferrer"
           class="px-4 py-2 bg-[#ADADAD] text-black font-semibold  flex items-center gap-2 hover:bg-gray-300 transition shadow"
           aria-label="Share on X">
            <i class="hn hn-x"></i>
            X
        </a>
        <a href={shareUrls.linkedin} target="_blank" rel="noopener noreferrer"
           class="px-4 py-2 bg-[#ADADAD] text-black font-semibold  flex items-center gap-2 hover:bg-gray-300 transition shadow"
           aria-label="Share on LinkedIn">
            <i class="hn hn-linkedin text-blue-800"></i>
            LinkedIn
        </a>
        <a href={shareUrls.whatsapp} target="_blank" rel="noopener noreferrer"
           class="px-4 py-2 bg-[#ADADAD] text-black font-semibold  flex items-center gap-2 hover:bg-gray-300 transition shadow"
           aria-label="Share on WhatsApp">
            <i class="hn hn-link text-green-700"></i>
            WhatsApp
        </a>
        <a href={shareUrls.telegram} target="_blank" rel="noopener noreferrer"
           class="px-4 py-2 bg-[#ADADAD] text-black font-semibold  flex items-center gap-2 hover:bg-gray-300 transition shadow"
           aria-label="Share on Telegram">
            <i class="hn hn-link text-blue-700"></i>
            Telegram
        </a>
        <button class="px-4 py-2 bg-[#ADADAD] text-black font-semibold  flex items-center gap-2 hover:bg-gray-300 transition shadow copy-link cursor-pointer"
                data-url={url} aria-label="Copy link to clipboard">
            <i class="hn hn-link"></i>
            Copy Link
        </button>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const copyButtons = document.querySelectorAll('.copy-link');
        
        copyButtons.forEach(button => {
            button.addEventListener('click', async function() {
                const url = this.getAttribute('data-url') || window.location.href;
                
                try {
                    await navigator.clipboard.writeText(url);
                    
                    const originalContent = this.innerHTML;
                    this.innerHTML = '<i class="hn hn-check"></i>Copied!';
                    this.classList.add('copied');
                    
                    setTimeout(() => {
                        this.innerHTML = originalContent;
                        this.classList.remove('copied');
                    }, 2000);
                    
                } catch (err) {
                    console.error('Failed to copy URL: ', err);
                    
                    const textArea = document.createElement('textarea');
                    textArea.value = url;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    try {
                        document.execCommand('copy');
                        const originalContent = this.innerHTML;
                        this.innerHTML = '<i class="fas fa-check"></i>Copied!';
                        this.classList.add('copied');
                        
                        setTimeout(() => {
                            this.innerHTML = originalContent;
                            this.classList.remove('copied');
                        }, 2000);
                    } catch (fallbackErr) {
                        console.error('Fallback copy failed: ', fallbackErr);
                        this.innerHTML = '<i class="fas fa-times"></i>Failed';
                        setTimeout(() => {
                            this.innerHTML = '<i class="fas fa-link"></i>Copy Link';
                        }, 2000);
                    }
                    
                    document.body.removeChild(textArea);
                }
            });
        });
    });
</script>
